name: CI Preload-ng Daemon

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: üõë Checkout do C√≥digo
        uses: actions/checkout@v4

      - name: üõ†Ô∏è Instalar Depend√™ncias de Build (Autotools & GLib)
        run: |
          # build-essential: Instala gcc, make, etc.
          # autotools: Ferramentas de configura√ß√£o (autoconf, automake, libtool).
          # libglib2.0-dev: Depend√™ncia cr√≠tica do projeto (GLib >= 2.14).
          sudo apt-get update
          sudo apt-get install -y build-essential autoconf automake libtool pkg-config libglib2.0-dev

      - name: ‚öôÔ∏è Configurar Projeto (Autotools no 'preload-src')
        run: |
          # Navega para o subdiret√≥rio que cont√©m 'configure.ac' e 'Makefile.am'
          cd preload-src
          
          # 1. Gera o script 'configure' e Makefiles
          autoreconf -i
          
          # 2. Executa o script de configura√ß√£o para gerar o Makefile principal na raiz.
          # O Autotools geralmente permite que o diret√≥rio de build seja diferente do diret√≥rio de origem.
          # Usamos '--srcdir=.' para indicar que estamos no diret√≥rio fonte.
          ./configure

      - name: üèóÔ∏è Compilar Projeto
        # O 'make' de n√≠vel superior (que est√° na raiz) ir√° executar a compila√ß√£o
        # navegando para os subdiret√≥rios 'src' e 'doc' conforme definido no Makefile.
        run: make

      - name: üß™ Executar Testes (make check)
        # Executa a su√≠te de testes do projeto C (se implementada via 'make check').
        run: make check

      - name: üì¶ Upload de Bin√°rio (preload-ng)
        # Salva o execut√°vel 'preload-ng', que √© gerado no subdiret√≥rio 'src/' (relativo √† raiz).
        # Este √© o caminho onde o bin√°rio final deve estar ap√≥s a compila√ß√£o.
        uses: actions/upload-artifact@v4
        with:
          name: preload-ng-daemon
          path: ./src/preload-ng
